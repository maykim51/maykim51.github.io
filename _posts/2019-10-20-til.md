---
title: "TIL - Today I Learned"
date: 2017-10-20 21:46:28 -0400
categories: 
    - til
tags:
    - til
    - scc
---

**2019/10/20**
ì˜¤ëŠ˜ ë‚´ê°€ ë°°ìš´ ê²ƒ ðŸŒŸ

## 1. Database
: MongoDBë¥¼ ìœ„í•œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„í•˜ëŠ” ë²•ì„ ë°°ì›€ (SQLê³¼ ë‹¤ë¦„)
  ì°¸ê³ : [6 Rules of Thumb for MongoDB Schema Design](https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-1)ë¥¼ ìš”ì•½í•œ [MongoDB ìŠ¤í‚¤ë§ˆ ë””ìžì¸ì„ ìœ„í•œ 6ê°€ì§€ ê·œì¹™ ìš”ì•½](https://edykim.com/ko/post/summary-of-six-rules-for-designing-a-mongodb-schema/)ë¥¼ ì½ê³  ì •ë¦¬í•¨
* ðŸŒŸðŸŒŸ DBë¥¼ ëª¨ë¸ë§í• ë•Œ ì§ˆë¬¸í•´ë³¼ ìˆœì„œ ðŸŒŸðŸŒŸ
    1. Cardinality of the relationships?  
        one-to-few/many/squillions ì–´ëŠ ê²ƒì¸ê°€?  
    2. "N"ìª½ì˜ objectë¥¼ ë”°ë¡œ ì ‘ê·¼í•  ê²ƒì¸ê°€?  
    3. Reads:Update ë¹„ìœ¨ì´ ì–´ë–¤ê°€? (denormalize í•´ì•¼í•˜ë‚˜?)  


## 1.1 MongoDBë¥¼ ìž˜ ëª¨ë¸ë§í•˜ê¸° ìœ„í•œ 6ê°€ì§€ ì›ì¹™ 
: from [ê³µì‹ì‚¬ì´íŠ¸](https://www.mongodb.com/blog/post/6-rules-of-thumb-for-mongodb-schema-design-part-3)
    1. ì›¬ë§Œí•˜ë©´ ìž„ë² ë”©í•œë‹¤.  
    2. ë‹¨, Objectë¥¼ ì§ì ‘ accessí•œë‹¤ë©´ ìž„ë² ë”© ì•ˆí•´ë„ ëœë‹¤.  
    3. Array ê¸¸ì´ê°€ ë°”ë€” ê±°ë¼ë©´ boundë¥¼ ê¼­ ë‘”ë‹¤. "Many"ì´ 100ê°œ ì´ìƒì´ë¼ë©´ ìž„ë² ë“œí•˜ì§€ ë§ìž. 1000ê°œ ì´ìƒì´ë©´ ObjectIDë¡œ í•˜ì§€ ë§ê³ , Mìª½ì—ì„œ 1ì„ referí•œë‹¤.  
    4. Application-level joinì„ ë‘ë ¤ì›Œ ë§ìž. (RDBì˜ server-side joinë³´ë‹¤ ì•„~~~ì£¼ ì§¸ë” ë” ë¬´ê±°ìš¸ ë¿.)  
    5. Denormalizingí• ë•ŒëŠ” Readê°€ WriteëŒ€ë¹„ í˜„ì €ížˆ ë†’ì„ë•Œì—¬ì•¼ í•œë‹¤.   
    6. ë‚´ ì„œë¹„ìŠ¤ê°€ query, updateí•˜ëŠ” ê²ƒì— ë§žì¶°ì„œ ëª¨ë¸ë§í•œë‹¤.  
    

## 1.2 Modeling - One-to few/many/squillions
: Factors to consider  
    -Stand-aloneí•´ì•¼ í•˜ëŠ” entityëŠ”?   
    -Cardinality? one-to-few/many/squillions?  
* **One-to-few** : embedí•œë‹¤. (e.g. Personì•ˆì— list of addressë¥¼ embed)
* **One-to-many** : ObjectIDs(12-byte) of parts in an array. Usually 100~999 parts. Use an **application-level-join** to retrieve parts for a particular product.
   ```
   > db.parts.findOne()
   {
    _id : ObjectID('AAAA'),
    partno : '123-aff-456',
    name : '#4 grommet',
    qty: 94,
    cost: 0.94,
    price: 3.99
   ```
   ```
   > db.parts.findOne()
   {
    name : 'left-handed smoke shifter',
    manufacturer : 'Acme Corp',
    catalog_number: 1234,
    parts : [     // array of references to Part documents
        ObjectID('AAAA'),    // reference to the #4 grommet above
        ObjectID('F17C'),    // reference to a different Part
        ObjectID('D2AA'),
        // etc
    ]
   ```
   **application-level-join**
   ```
    // Fetch the Product document identified by this catalog number
    > product = db.products.findOne({catalog_number: 1234});
    // Fetch all the Parts that are linked to this Product
    > product_parts = db.parts.find({_id: { $in : product.parts } } ).toArray() ;
   ```
* **One-to-squillions**: Parent referencing. > 16MB document size (e.g. event logging system)
   ```
   > db.hosts.findOne()
    {
        _id : ObjectID('AAAB'),
        name : 'goofy.example.com',
        ipaddr : '127.66.66.66'
    }

    >db.logmsg.findOne()
    {
        time : ISODate("2014-03-28T09:42:41.382Z"),
        message : 'cpu is on fire!',
        host: ObjectID('AAAB')       // Reference to the Host document
    }
   ```
   ```
     // find the parent â€˜hostâ€™ document
    > host = db.hosts.findOne({ipaddr : '127.66.66.66'});  // assumes unique index
    // find the most recent 5000 log message documents linked to that host
    > last_5k_msg = db.logmsg.find({host: host._id}).sort({time : -1}).limit(5000).toArray()
   ```
  
## 1.3 Denormalizaion and Two-Way Referencing
: Factors to consider  
    -atomic updateì´ í•„ìš”í•œê°€? (ëª»í•˜ê²Œ ë¨)  
    -high read to write ratioê°€ ë†’ì€ê°€? (ë†’ì§€ ì•Šìœ¼ë©´ ì“°ì§€ X)  

### 1.3.1 Two-Way Referencing
: "One" -> "Many" & "Many" -> "One"
* 'N'ë¶€ë¶„ì— í•´ë‹¹í•˜ëŠ” 'Task'ì—ë„ Personì— ëŒ€í•œ referenceë¥¼ ì¶”ê°€í•œë‹¤.  (ì—¬ê¸°ì„œëŠ” 'owner')
    ```
    db.tasks.findOne()
    {
        _id: ObjectID("ADF9"), 
        description: "Write lesson plan",
        due_date:  ISODate("2014-04-01"),
        owner: ObjectID("AAF1")     // Reference to Person document
    }
    ```
* ì—…ë°ì´íŠ¸ë•Œë§ˆë‹¤ ë‘ ë²ˆì˜ ì—…ë°ì´íŠ¸ë¥¼ í•´ì¤˜ì•¼ í•œë‹¤ëŠ” ë²ˆê±°ë¡œì›€ì´ ìžˆë‹¤.


### 1.3.2 Denormalizing
: ObjectIDë§Œì´ ì•„ë‹ˆë¼ 'name'ë“±ë“±ì„ ì¶”ê°€í•œë‹¤. Denormalizingì„ í•˜ë©´ application-level joinì„ í•  í•„ìš”ê°€ ì—†ë‹¤.
* Update ëŒ€ë¹„ Readê°€ í˜„ì €ížˆ ë§Žì„ ë•Œ ì‚¬ìš©í•œë‹¤. (Updateê°€ ëŠë ¤ì§€ëŠ” ë°©ë²•ì´ë¼ì„œ)
* atomic ë˜ëŠ” isolated updatesë¥¼ ìžƒê²Œë¨. (e.g. 'name'ì„ ì—…ë°ì´íŠ¸í•´ì¤˜ì•¼ í•¨)
    ```
    > db.products.findOne()
    {
        name : 'left-handed smoke shifter',
        manufacturer : 'Acme Corp',
        catalog_number: 1234,
        parts : [
            { id : ObjectID('AAAA'), name : '#4 grommet' },         // Part name is denormalized
            { id: ObjectID('F17C'), name : 'fan blade assembly' },
            { id: ObjectID('D2AA'), name : 'power switch' },
            // etc
        ]
    }
    ```
    application-level join
    ```
    // Fetch the product document
    > product = db.products.findOne({catalog_number: 1234});  
    // Create an array of ObjectID()s containing *just* the part numbers
    > part_ids = product.parts.map( function(doc) { return doc.id } );
    // Fetch all the Parts that are linked to this Product
    > product_parts = db.parts.find({_id: { $in : part_ids } } ).toArray() ;
    ```